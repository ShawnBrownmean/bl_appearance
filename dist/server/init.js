var W=Object.create;var v=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var A=r=>t=>{var e=r[t];if(e)return e();throw new Error("Module not found in bundle: "+t)};var m=(r,t)=>()=>(r&&(t=r(r=0)),t);var G=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),O=(r,t)=>{for(var e in t)v(r,e,{get:t[e],enumerable:!0})},V=(r,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of U(t))!B.call(r,n)&&n!==e&&v(r,n,{get:()=>t[n],enumerable:!(a=F(t,n))||a.enumerable});return r};var g=(r,t,e)=>(e=r!=null?W(D(r)):{},V(t||!r||!r.__esModule?v(e,"default",{value:r,enumerable:!0}):e,r));function c(r,t,...e){let a;do a=`${r}:${Math.floor(Math.random()*100001)}:${t}`;while(T[a]);return emitNet(`_bl_cb_${r}`,t,R,a,...e),new Promise(n=>{T[a]=n})}function s(r,t){onNet(`_bl_cb_${r}`,async(e,a,...n)=>{let i=source,f;try{f=await t(i,...n)}catch(H){console.error(`an error occurred while handling callback event ${r}`),console.log(`^3${H.stack}^0`)}emitNet(`_bl_cb_${e}`,i,a,f)})}var R,T,y,E=m(()=>{R=GetCurrentResourceName(),T={};onNet(`_bl_cb_${R}`,(r,...t)=>{let e=T[r];return e&&e(...t)});y=exports.bl_bridge.core()});var d=G(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.oxmysql=void 0;var N=[];function b(r,t){if(!r)throw new TypeError(t)}var l=(r,t,e,a)=>{if(typeof r=="number"&&(r=N[r]),a?b(typeof r=="object",`First argument expected object, recieved ${typeof r}`):b(typeof r=="string",`First argument expected string, received ${typeof r}`),t){let n=typeof t;b(n==="object"||n==="function",`Second argument expected object or function, received ${n}`),!e&&n==="function"&&(e=t,t=void 0)}return e!==void 0&&b(typeof e=="function",`Third argument expected function, received ${typeof e}`),[r,t,e]},_=global.exports.oxmysql,z=GetCurrentResourceName();function p(r,t,e){return new Promise((a,n)=>{_[r](t,e,(i,f)=>{if(f)return n(f);a(i)},z,!0)})}S.oxmysql={store(r){return b(typeof r!="string",`Query expects a string, received ${typeof r}`),N.push(r)},ready(r){setImmediate(async()=>{for(;GetResourceState("oxmysql")!=="started";)await new Promise(t=>setTimeout(t,50));r()})},async query(r,t,e){[r,t,e]=l(r,t,e);let a=await p("query",r,t);return e?e(a):a},async single(r,t,e){[r,t,e]=l(r,t,e);let a=await p("single",r,t);return e?e(a):a},async scalar(r,t,e){[r,t,e]=l(r,t,e);let a=await p("scalar",r,t);return e?e(a):a},async update(r,t,e){[r,t,e]=l(r,t,e);let a=await p("update",r,t);return e?e(a):a},async insert(r,t,e){[r,t,e]=l(r,t,e);let a=await p("insert",r,t);return e?e(a):a},async prepare(r,t,e){[r,t,e]=l(r,t,e);let a=await p("prepare",r,t);return e?e(a):a},async rawExecute(r,t,e){[r,t,e]=l(r,t,e);let a=await p("rawExecute",r,t);return e?e(a):a},async transaction(r,t,e){[r,t,e]=l(r,t,e,!0);let a=await p("transaction",r,t);return e?e(a):a},isReady(){return _.isReady()},async awaitConnection(){return await _.awaitConnection()}}});var k,u,w=m(()=>{k=g(d(),1),u=async(r,t,e)=>{let a={drawables:e.drawables,props:e.props,headOverlay:e.headOverlay},n={headBlend:e.headBlend,headStructure:e.headStructure,hairColor:e.hairColor,model:e.model},i=e.tattoos||[];return await k.oxmysql.prepare("INSERT INTO appearance (id, clothes, skin, tattoos) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE clothes = VALUES(clothes), skin = VALUES(skin), tattoos = VALUES(tattoos);",[t,JSON.stringify(a),JSON.stringify(n),JSON.stringify(i)])}});var Q={};var C=m(()=>{});var x={};O(x,{default:()=>X});var h,K,Y,X,j=m(()=>{h=g(d(),1);E();w();K=r=>new Promise(t=>setTimeout(t,r)),Y=async r=>{let t=await h.oxmysql.query("SELECT * FROM `players`");if(t){for(let e of t)if(e.skin){await c("bl_appearance:client:migration:setAppearance",r,{type:"fivem",data:JSON.parse(e.skin)}),await K(100);let a=await c("bl_appearance:client:getAppearance",r);await u(r,e.citizenid,a)}console.log("Converted "+t.length+" appearances")}},X=Y});var P={};O(P,{default:()=>ee});var L,Z,q,ee,J=m(()=>{L=g(d(),1);E();w();Z=r=>new Promise(t=>setTimeout(t,r)),q=async r=>{let t=await L.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1`");if(t){for(let e of t)if(e.skin){await c("bl_appearance:client:migration:setAppearance",r,{type:"illenium",data:JSON.parse(e.skin)}),await Z(100);let a=await c("bl_appearance:client:getAppearance",r);await u(r,e.citizenid,a)}console.log("Converted "+t.length+" appearances")}},ee=q});var I={};O(I,{default:()=>ae});var M,te,re,ae,$=m(()=>{M=g(d(),1);E();w();te=r=>new Promise(t=>setTimeout(t,r)),re=async r=>{let t=await M.oxmysql.query("SELECT * FROM `playerskins` WHERE active = 1");if(t){for(let e of t){emitNet("qb-clothes:loadSkin",r,0,e.model,e.skin),await te(200);let a=await c("bl_appearance:client:getAppearance",r);await u(r,e.citizenid,a)}console.log("Converted "+t.length+" appearances")}},ae=re});E();var o=g(d(),1);w();var ne=A({"./migrate/esx.ts":()=>Promise.resolve().then(()=>(C(),Q)),"./migrate/fivem.ts":()=>Promise.resolve().then(()=>(j(),x)),"./migrate/illenium.ts":()=>Promise.resolve().then(()=>(J(),P)),"./migrate/qb.ts":()=>Promise.resolve().then(()=>($(),I))});s("bl_appearance:server:getOutfits",async(r,t)=>{let e=y.GetPlayer(r).job||{name:"unknown",grade:{name:"unknown"}},a=await o.oxmysql.prepare("SELECT * FROM outfits WHERE player_id = ? OR (jobname = ? AND jobrank <= ?)",[t,e.name,e.grade.name]);return a?(Array.isArray(a)||(a=[a]),a.map(i=>({id:i.id,label:i.label,outfit:JSON.parse(i.outfit),jobname:i.jobname}))):[]});s("bl_appearance:server:renameOutfit",async(r,t,e)=>{let a=e.id,n=e.label;return await o.oxmysql.update("UPDATE outfits SET label = ? WHERE player_id = ? AND id = ?",[n,t,a])});s("bl_appearance:server:deleteOutfit",async(r,t,e)=>await o.oxmysql.update("DELETE FROM outfits WHERE player_id = ? AND id = ?",[t,e])>0);s("bl_appearance:server:saveOutfit",async(r,t,e)=>{let a=null,n=0;return e.job&&(a=e.job.name,n=e.job.rank),console.log(t,e.label,JSON.stringify(e.outfit),a,n),await o.oxmysql.insert("INSERT INTO outfits (player_id, label, outfit, jobname, jobrank) VALUES (?, ?, ?, ?, ?)",[t,e.label,JSON.stringify(e.outfit),a,n])});s("bl_appearance:server:grabOutfit",async(r,t)=>{let e=await o.oxmysql.prepare("SELECT outfit FROM outfits WHERE id = ?",[t]);return JSON.parse(e)});s("bl_appearance:server:itemOutfit",async(r,t)=>{y.GetPlayer(r).addItem("cloth",1,t)});s("bl_appearance:server:importOutfit",async(r,t,e,a)=>{let[n]=await o.oxmysql.query("SELECT label, outfit FROM outfits WHERE id = ?",[e]);return n?{success:!0,newId:await o.oxmysql.insert("INSERT INTO outfits (player_id, label, outfit) VALUES (?, ?, ?)",[t,a,n.outfit])}:{success:!1,message:"Outfit not found"}});s("bl_appearance:server:saveSkin",async(r,t,e)=>await o.oxmysql.update("UPDATE appearance SET skin = ? WHERE id = ?",[JSON.stringify(e),t]));s("bl_appearance:server:saveClothes",async(r,t,e)=>await o.oxmysql.update("UPDATE appearance SET clothes = ? WHERE id = ?",[JSON.stringify(e),t]));s("bl_appearance:server:saveAppearance",u);s("bl_appearance:server:saveTattoos",async(r,t,e)=>await o.oxmysql.update("UPDATE appearance SET tattoos = ? WHERE id = ?",[JSON.stringify(e),t]));s("bl_appearance:server:getSkin",async(r,t)=>{let e=await o.oxmysql.prepare("SELECT skin FROM appearance WHERE id = ?",[t]);return JSON.parse(e)});s("bl_appearance:server:getClothes",async(r,t)=>{let e=await o.oxmysql.prepare("SELECT clothes FROM appearance WHERE id = ?",[t]);return JSON.parse(e)});s("bl_appearance:server:getTattoos",async(r,t)=>{let e=await o.oxmysql.prepare("SELECT tattoos FROM appearance WHERE id = ?",[t]);return JSON.parse(e)||[]});s("bl_appearance:server:getAppearance",async(r,t)=>{let e=await o.oxmysql.single("SELECT * FROM appearance WHERE id = ? LIMIT 1",[t]);if(!e)return null;let a={...JSON.parse(e.skin),...JSON.parse(e.clothes),...JSON.parse(e.tattoos)};return a.id=e.id,a});onNet("bl_appearance:server:setroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),source)});onNet("bl_appearance:server:resetroutingbucket",()=>{SetPlayerRoutingBucket(source.toString(),0)});RegisterCommand("migrate",async r=>{r=r!==0?r:parseInt(getPlayers()[0]);let e=exports.bl_appearance.config();(await ne(`./migrate/${e.previousClothing==="fivem-appearance"?"fivem":e.previousClothing}.ts`)).default(r)},!1);y.RegisterUsableItem("cloth",async(r,t,e)=>{y.GetPlayer(r)?.removeItem("cloth",1,t)&&emitNet("bl_appearance:server:useOutfit",r,e.outfit)});
